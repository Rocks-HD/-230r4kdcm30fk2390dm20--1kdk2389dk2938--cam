"use strict";angular.module("camara").controller("HomeController",["$scope","$location","$window","BaseService",function(a,b,c,d){a.APPLICATION_ENV=d.APPLICATION_ENV,a.url=d.url,a.login=d.login,a.upload=d.upload,a.options,a.mercados,a.msgPainel,a.identity=d.identity,a.lstRelacao={},a.lstFornecedores={},a.lstFamilias={},a.lstSimilares={},a.lstConcorrentes={},a.lstProdutos={},a.redirecionar=function(a){b.path("/"+a),c.location.reload()},$(document).on("click","#btnEnviar",function(){$.when(resultAjaxSubmit).then(function(a){"success"===a.type&&(d.salvarInfoLogin(a),window.location.hash="/mensagens")})}),angular.element(document).ready(function(){d.manterMercados()})}]),angular.module("camara").controller("MainController",["$scope","$location","$window","BaseService","ImagemService","LayoutService","UtilsService",function(a,b,c,d,e,f,g){a.APPLICATION_ENV=d.APPLICATION_ENV,a.url=d.url,a.login=d.login,a.upload=d.upload,a.options,a.mercados,a.msgPainel,a.identity=d.identity,a.lstRelacao={},a.lstFornecedores={},a.lstFamilias={},a.lstSimilares={},a.lstConcorrentes={},a.lstProdutos={},a.redirecionar=function(a){b.path("/"+a),c.location.reload()},a.salvarEnviarInformacoesSimilar=function(b){$(".btn-ok, .btnSalvarFamilia").button("loading"),$("#formSalvarVisita"+b+" .msgSystemAlert").removeClass("in"),a.prepararInformacoesSimilar(b)&&("development"==a.APPLICATION_ENV||navigator.network.connection.type!=Connection.NONE?a.enviarSemFotos():(alert('Você não possui conexão com a internet, suas informações ficarão na área de "Denúncias pendentes".'),a.salvarBase()))},a.prepararInformacoesSimilar=function(b){try{var c=!1,d={};if(""!=$("#ds_latlong").val()){a.options={},d.co_funcionario=$("#formSalvarVisita"+b+" #co_funcionario"+b).val(),d.co_filial_mercado=$("#formSalvarVisita"+b+" #co_filial_mercado"+b).val(),d.co_similar=$("#formSalvarVisita"+b+" #co_similar"+b).val(),d.ds_latlong=$("#formSalvarVisita"+b+" #ds_latlong"+b).val(),d.st_disponibilidade=$("#formSalvarVisita"+b+" #st_disponibilidade"+b).val(),d.ds_confirmar_falta=$("#formSalvarVisita"+b+" #ds_confirmar_falta"+b).val(),d.vl_meu_preco=$("#formSalvarVisita"+b+" #vl_meu_preco"+b).val(),d.lst_produtos_existentes=$("#formSalvarVisita"+b+" #lst_produtos_existentes"+b).val();for(var e in a.lstConcorrentes[b])d["vl_preco_concorrente"+e]=$("#formSalvarVisita"+b+" #vl_preco_concorrente"+e).val();a.options.params=d,c=!0}else alert("Não foi possível identificar sua localização ative o serviço de localização."),$(".btn-ok, .btnSalvarFamilia").button("reset")}catch(a){$(".btn-ok, .btnSalvarFamilia").button("reset"),alert("Houve um erro interno e não foi possível carregar as informações para envio do formulário.")}return c},a.salvarEnviarInformacoesFamilia=function(b){$(".btn-ok, .btnSalvarFamilia").button("loading"),$("#formSalvarVisitaFamilia"+b+" .msgSystemAlert"+b).removeClass("in"),a.prepararInformacoesFamilia(b)&&("development"==a.APPLICATION_ENV||navigator.network.connection.type!=Connection.NONE?a.enviarInformacoesFamilia():(alert('Você não possui conexão com a internet, suas informações ficarão na área de "Denúncias pendentes".'),a.salvarBase()))},a.prepararInformacoesFamilia=function(b){try{var c=!1,d={};""!=$("#ds_latlong").val()?("development"!=a.APPLICATION_ENV?(a.options=new FileUploadOptions,a.options.fileKey="file",a.options.uri=$(".foto-local").attr("src"),a.options.fileName="undefined"!=typeof $(".foto-local").attr("src")?$(".foto-local").attr("src").substr($(".foto-local").attr("src").lastIndexOf("/")+1):"",a.options.mimeType="text/plain"):a.options={},d.co_funcionario=$("#formSalvarVisitaFamilia"+b+" #co_funcionario"+b).val(),d.co_filial_mercado=$("#formSalvarVisitaFamilia"+b+" #co_filial_mercado"+b).val(),d.co_familia=$("#formSalvarVisitaFamilia"+b+" #co_familia"+b).val(),d.ds_latlong=$("#formSalvarVisitaFamilia"+b+" #ds_latlong"+b).val(),d.tt_gondolas=$("#formSalvarVisitaFamilia"+b+" #tt_gondolas"+b).val(),d.tm_gondolas=$("#formSalvarVisitaFamilia"+b+" #tm_gondolas"+b).val(),d.tt_frente=$("#formSalvarVisitaFamilia"+b+" #tt_frente"+b).val(),d.file=$("#formSalvarVisitaFamilia"+b+" .foto-local"+b).attr("src"),d.st_ponto_extra=$("#formSalvarVisitaFamilia"+b+" #st_ponto_extra"+b).val(),a.options.params=d,c=!0):(alert("Não foi possível identificar sua localização ative o serviço de localização."),$(".btn-ok, .btnSalvarFamilia").button("reset"))}catch(a){$(".btn-ok, .btnSalvarFamilia").button("reset"),alert("Houve um erro interno e não foi possível carregar as informações para envio do formulário.")}return c},a.enviarInformacoesFamilia=function(){"./js/modules/mobileapp/layouts/imagens/fotos/foto1.jpg"!=a.options.params.file?a.enviarComFotosFamilia():a.enviarSemFotosFamilia()},a.enviarComFotosFamilia=function(){try{var b=new FileTransfer,c=a.options.params.co_familia;exibirTarjaAjax("Enviando as informações, aguarde!"),b.upload($(".foto-local").attr("src"),encodeURI(a.upload+"-familia"),function(b){console.log(b),200==b.responseCode?f._padraoSalvarFamilia(b,c,a.options):404==b.responseCode?alert("Não foi possível enviar as suas informações. Tente novamente mais tarde. Erro 404"):500==b.responseCode&&alert("Não foi possível enviar as suas informações. Tente novamente mais tarde. Erro 500"),$(".ajaxCarregando").remove()},function(a){alert("Não foi possível enviar as suas informações. Tente novamente mais tarde. Erro de envio"),console.log(a)},a.options,!0)}catch(a){console.log(a)}},a.enviarSemFotosFamilia=function(){var b=a.options.params.co_familia;$.post(a.upload+"-familia",a.options.params,function(c){f._padraoSalvarFamilia(c,b,a.options)})},a.enviarSemFotos=function(){var b=a.options.params.co_similar;$.post(a.upload,a.options.params,function(c){f._padraoSalvarSimilar(c,b,a.options)})},a.enviarDaBase=function(b){try{var c=new FileTransfer;a.options=JSON.parse(localStorage.getItem(b)),navigator.network.connection.type!=Connection.NONE?c.upload(a.options.uri,encodeURI(a.upload),function(a){200==a.responseCode?(console.log("Response = "+a.response),localStorage.removeItem(b),alert("Mensagem enviada com sucesso!"),window.location.hash="/"):404==a.responseCode?alert("Sua aplicação pode esta desatualizada, atualize para e tente enviar a denúncia mais tarde."):500==a.responseCode&&alert("O servidor de resposta esta indisponível no momento, tente novamente mais tarde!")},function(a){alert("Devido um erro interno não foi possível enviar suas informações para o servidor da camara.")},a.options,!0):alert("Para enviar esta denúncia é necessário estar conectado a internet.")}catch(a){}},a.initAreaMensagem=function(){a.msgPainel=d.getMsgPainel(),$(".tela2 .titulo").html(a.msgPainel.titulo),$(".tela2 .mensagem").html(a.msgPainel.mensagem)},a.initAreaVisita=function(){0==Object.keys(a.lstFornecedores).length&&(a.identity=d.getIdentity(),a.lstRelacao=d.getLstRelacao(),a.lstFornecedores=d.getFornecedores(),a.lstFamilias=d.getFamilia(),a.lstSimilares=d.getCatSimilares(),a.lstProdutos=d.getProdutos(),a.lstConcorrentes=d.getConcorrentes()),g._getLatLong(),f._formSelectFornecedor(a.lstFornecedores,a.lstFamilias)},$(document).on("change","#co_categoria",function(){var a=$(this).val();$("[id^='co_subcategoria_']").addClass("hidden"),$(".listarProdutos").addClass("hidden"),""!=a?$(".familia, #co_subcategoria_"+a).removeClass("hidden"):$(".familia, #co_subcategoria_"+a).addClass("hidden"),g._getLatLong()}).on("change","[id^='co_subcategoria_']",function(){$(".listarProdutos").removeClass("hidden")}),$(document).on("click",".item-produto .tem-o-produto>span[class*='btn']",function(){var a=$.inArray("btnSim",$(this).attr("class").split(" "))!=-1?"btnSim":"btnNao",b=$(this).parents("form").attr("id").replace(/[A-Za-z_$-]/g,"");$(this).removeClass("opacity-menor").parent().find(":not(."+a+")").addClass("opacity-menor"),$(this).parent().removeClass("tem-o-produto-sim").removeClass("tem-o-produto-nao").addClass("btnSim"==a?"tem-o-produto-sim":"tem-o-produto-nao"),"btnSim"==a?($(this).parents(".detalhes-produto").find(".mostra-detalhes-produtos").removeClass("hidden"),$(this).parents(".detalhes-produto").find(".confirmarFaltaProduto").addClass("hidden"),$("#st_disponibilidade"+b).val("S")):($(this).parents(".detalhes-produto").find(".mostra-detalhes-produtos").addClass("hidden"),$(this).parents(".detalhes-produto").find(".confirmarFaltaProduto").removeClass("hidden"),$("#st_disponibilidade"+b).val("N"))}),$(document).on("click",".item-produto .pdv-similares .tem-similares>span[class*='btn']",function(){var a=$.inArray("btnSim",$(this).attr("class").split(" "))!=-1?"btnSim":"btnNao";$(this).removeClass("opacity-menor").parent().find(":not(."+a+")").addClass("opacity-menor"),"btnSim"===a?$(this).parents(".pdv-similares").next().addClass("hidden"):($(this).parents(".pdv-similares").next().removeClass("hidden"),$(this).parents(".pdv-similares").next().find("span").addClass("opacity-menor"))}).on("click",".item-produto .pdv-similares-result .item-produto-similar>span[class*='btn']",function(){var a=$(this).parents(".pdv-similares-result").prev().find(".opacity-menor").hasClass("btnNao")?"sim":"nao",b=$(this).attr("id").substr(0,$(this).attr("id").indexOf("produto")),c=$(this).attr("id").substr($(this).attr("id").indexOf("produto")+7),d=new Array,e=-1;"sim"===a&&($(this).toggleClass("opacity-menor"),d=$("#lst_produtos_existentes"+b).val().split(";"),$(this).hasClass("opacity-menor")?(e=d.indexOf(c),e>-1&&d.splice(e,1)):d.push(c),$("#lst_produtos_existentes"+b).val(d.join(";")))}),$(document).on("click",".mostra-detalhes-produtos>div",function(){var a=$(this).parents("form").attr("id"),b=$(this).attr("class");$("#"+a+" ."+b+"-result").toggleClass("hidden"),$("#"+a+" ."+b+"-detalhes>p>span").toggleClass("glyphicon-chevron-down").toggleClass("glyphicon-menu-right")}),$(document).on("click",".pontoExtra-result>span",function(){var a=$(this).hasClass("sim-extra")?"sim":"nao";$(this).parent().find(".sim-extra, .nao-extra").removeClass("active"),$(this).addClass("active"),$(this).parent().find("input[id^='st_ponto_extra']").val("sim"==a?"S":"N")}),$(document).on("change","[id^='co_subcategoria_']",function(){var b=$(this).find("option:selected").text(),c=parseInt($(this).val()),e=d.cadastrarItensVisitados(null,null),g=new Array;if("undefined"!=typeof a.lstSimilares[c]){$(".resultado-da-pesquisa .titulo span").html(b),$(".resultado-da-pesquisa .numero-itens span").html(Object.keys(a.lstSimilares[c]).length),$(".areaProdutos").html(""),$(".areaProdutos").append(f._layoutSimilares(a.lstSimilares[c],a.lstProdutos,a.lstConcorrentes,c,a.upload,a.identity.coFuncionario,a.identity.coFilial,a.identity.latLong));for(var h in e){var i=e[h].params,j=i.co_similar,k=i.co_familia?i.co_familia:null;for(var l in i)null!=j?$("#formSalvarVisita"+j+" #"+l+", #formSalvarVisita"+j+" #"+l+j).val(i[l]):$("#formSalvarVisitaFamilia"+k+" #"+l+k).val(i[l]);if("undefined"!=typeof i.lst_produtos_existentes){$("#formSalvarVisita"+j+" .glyphicon-heart-empty").removeClass("glyphicon-heart-empty icoEnviar").addClass("glyphicon-heart"),"S"==i.st_disponibilidade?($("#formSalvarVisita"+j+" .tem-o-produto>.btnSim").removeClass("opacity-menor"),$("#formSalvarVisita"+j+" .tem-o-produto").addClass("tem-o-produto-sim"),$("#formSalvarVisita"+j+" .mostra-detalhes-produtos").find("input").attr("readonly","readonly"),$("#formSalvarVisita"+j+" .btnNao").removeClass("btnNao")):($("#formSalvarVisita"+j+" .tem-o-produto>.btnNao").removeClass("opacity-menor"),$("#formSalvarVisita"+j+" .tem-o-produto").addClass("tem-o-produto-nao"),$("#ds_confirmar_falta"+j).val("em falta").attr("readonly","readonly"),$("#formSalvarVisita"+j+" .btnSim").removeClass("btnSim")),g=i.lst_produtos_existentes.split(";");for(var m in g)""!=g[m]&&($("#formSalvarVisita"+j+" .tem-similares .btnSim").removeClass("opacity-menor"),$("#formSalvarVisita"+j+" #"+j+"produto"+g[m]).removeClass("opacity-menor"))}else $("#formSalvarVisitaFamilia"+k+" ."+("S"==i.st_ponto_extra?"sim-extra":"nao-extra")).addClass("active"),$("#formSalvarVisitaFamilia"+k+" .mostra-detalhes-produtos").find("input").attr("readonly","readonly"),$(".btnSalvarFamilia"+k).prop("disabled",!0).html("Família concluída")}}}),$(document).on("click",".imgPhotoClick",function(){e.capturarFoto()}).on("click",".btnRemoverImagem",function(){e.removerImagem()}),$(document).on("click",".icoEnviar",function(){var b=$(this).attr("data-id");a.salvarEnviarInformacoesSimilar(b)}),$(document).on("click",".btnSalvarFamilia",function(){var b=$(this).attr("data-id");a.salvarEnviarInformacoesFamilia(b)}),$(document).on("click","#btnEnviar",function(){$.when(resultAjaxSubmit).then(function(a){"success"===a.type&&(d.salvarInfoLogin(a),window.location.hash="/mensagens")})}),$(document).on("click",".btnSalvarConcorrente",function(){var b=$(this).parent().attr("data-url"),c=$(this).attr("data-id"),e=$("#no_concorrente"+c).val(),f={},g={},h=d.getSimilares(),i=this;""!=e?($(i).button("loading"),$.post(b,{co_similar:c,no_concorrente:e},function(b){"success"===b.type?(f[b.id]=e,"undefined"!=typeof h.concorrentes[c]?$.extend(h.concorrentes[c],f):(g[c]=f,$.extend(h.concorrentes,g)),$("#no_concorrente"+c).val(""),d.setSimilares(h),a.lstConcorrentes=d.getConcorrentes(),$('<input type="text" placeholder="Preço '+e+'" name="vl_preco_concorrente'+b.id+'" id="vl_preco_concorrente'+b.id+'">').insertBefore(".fieldBtnAddConcorrente"+c),$(".areaAddConcorrente"+c).removeClass("in"),$(i).button("reset")):alert(b.flashMsg)})):alert("É necessário informar um nome do produto concorrente!")}),angular.element(document).ready(function(){"#/"==window.location.hash?d.manterMercados():"#/mensagens"==window.location.hash&&a.initAreaMensagem(),a.initAreaVisita()})}]),angular.module("camara").controller("MensagensController",["$scope","$location","$window","BaseService",function(a,b,c,d){a.APPLICATION_ENV=d.APPLICATION_ENV,a.url=d.url,a.login=d.login,a.upload=d.upload,a.options,a.mercados,a.msgPainel,a.identity=d.identity,a.lstRelacao={},a.lstFornecedores={},a.lstFamilias={},a.lstSimilares={},a.lstConcorrentes={},a.lstProdutos={},a.redirecionar=function(a){b.path("/"+a),c.location.reload()},a.initAreaMensagem=function(){a.msgPainel=d.getMsgPainel(),$(".tela2 .titulo").html(a.msgPainel.titulo),$(".tela2 .mensagem").html(a.msgPainel.mensagem)},angular.element(document).ready(function(){a.initAreaMensagem()})}]);